#!/bin/bash

input_file="$1"
genome_file="/n/home01/hl141/lh3/bwadb/hs37m.fa"

grep "^NV" ${input_file} | awk -F $'\t' 'BEGIN {OFS = FS; reverse_complement["A"]="T"; reverse_complement["C"]="G"; reverse_complement["G"]="C"; reverse_complement["T"]="A";} {if ($4=="A"||$4=="C"){print $2,$3-2,$3+1,$1 ":" $4 $5,"0","+";} else {print $2,$3-2,$3+1,$1 ":" reverse_complement[$4] reverse_complement[$5],"0","-";}}' | bedtools getfasta -s -name -bed stdin -fi ${genome_file} | awk '{if(NR%2==1){split($0,name_array,":");}else{print name_array[2] "_" $0;}} END {print "AC_AAA"; print "AC_AAC"; print "AC_AAG"; print "AC_AAT"; print "AC_CAA"; print "AC_CAC"; print "AC_CAG"; print "AC_CAT"; print "AC_GAA"; print "AC_GAC"; print "AC_GAG"; print "AC_GAT"; print "AC_TAA"; print "AC_TAC"; print "AC_TAG"; print "AC_TAT"; print "AG_AAA"; print "AG_AAC"; print "AG_AAG"; print "AG_AAT"; print "AG_CAA"; print "AG_CAC"; print "AG_CAG"; print "AG_CAT"; print "AG_GAA"; print "AG_GAC"; print "AG_GAG"; print "AG_GAT"; print "AG_TAA"; print "AG_TAC"; print "AG_TAG"; print "AG_TAT"; print "AT_AAA"; print "AT_AAC"; print "AT_AAG"; print "AT_AAT"; print "AT_CAA"; print "AT_CAC"; print "AT_CAG"; print "AT_CAT"; print "AT_GAA"; print "AT_GAC"; print "AT_GAG"; print "AT_GAT"; print "AT_TAA"; print "AT_TAC"; print "AT_TAG"; print "AT_TAT"; print "CA_ACA"; print "CA_ACC"; print "CA_ACG"; print "CA_ACT"; print "CA_CCA"; print "CA_CCC"; print "CA_CCG"; print "CA_CCT"; print "CA_GCA"; print "CA_GCC"; print "CA_GCG"; print "CA_GCT"; print "CA_TCA"; print "CA_TCC"; print "CA_TCG"; print "CA_TCT"; print "CG_ACA"; print "CG_ACC"; print "CG_ACG"; print "CG_ACT"; print "CG_CCA"; print "CG_CCC"; print "CG_CCG"; print "CG_CCT"; print "CG_GCA"; print "CG_GCC"; print "CG_GCG"; print "CG_GCT"; print "CG_TCA"; print "CG_TCC"; print "CG_TCG"; print "CG_TCT"; print "CT_ACA"; print "CT_ACC"; print "CT_ACG"; print "CT_ACT"; print "CT_CCA"; print "CT_CCC"; print "CT_CCG"; print "CT_CCT"; print "CT_GCA"; print "CT_GCC"; print "CT_GCG"; print "CT_GCT"; print "CT_TCA"; print "CT_TCC"; print "CT_TCG"; print "CT_TCT";}' | sort | uniq -c | awk 'BEGIN {OFS = "\t"} {print $2,$1-1;}'
